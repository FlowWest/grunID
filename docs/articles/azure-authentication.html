<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="grunID">
<title>Authentication with Azure AD • grunID</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authentication with Azure AD">
<meta property="og:description" content="grunID">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">grunID</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/azure-authentication.html">Authentication with Azure AD</a>
    <a class="dropdown-item" href="../articles/process_and_add_assay_results.html">Process and add assay results to database</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/FlowWest/grunID" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Authentication with Azure AD</h1>
            
      
      
      <div class="d-none name"><code>azure-authentication.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grunID</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="confirm-account-on-azure">Confirm Account on Azure<a class="anchor" aria-label="anchor" href="#confirm-account-on-azure"></a>
</h2>
<p>The first step in the process is to confirm that your account has
been successfully linked to Azure. To do this, navigate to the
<a href="https://portal.azure.com/" target="_blank" class="external-link">Microsoft Azure
Portal</a> and log in with your existing credentials or create a new
account. Once logged in, click on your account as shown below.</p>
<p><img src="assets/arrow-to-account-button.png" style="width:75.0%"></p>
<p>Next, click on <strong>Switch Directory</strong></p>
<p><img src="assets/azure-switch-directories.png" style="width:50.0%"></p>
<p>and confirm you have a directory for the California Department of
Water Resources. If you are not already switched to this directory do so
now. If you do not see this directory contact Emanuel Rodriguez at <a href="mailto:erodriguez@flowwest.com">erodriguez@flowwest.com</a> for
help.</p>
<p><img src="assets/azure-dir-list.png" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="install-dependencies">Install Dependencies<a class="anchor" aria-label="anchor" href="#install-dependencies"></a>
</h2>
<p>In addition to installing the R package, we need to install the Azure
Command Line Interface (CLI) to authenticate through Azure Directory.
The Azure CLI allows us to link a local R session with your Azure AD
account and authenticate a user with read/write permissions to the
database using a “token”. An overview of the tool can be found at
<a href="https://learn.microsoft.com/en-us/cli/azure/" target="_blank" class="external-link">https://learn.microsoft.com/en-us/cli/azure/</a>.
To download and install the tool, visit the
<a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli" target="_blank" class="external-link">Install
Azure CLI on Windows</a> page, or for Mac OS visit the
<a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-macos" target="_blank" class="external-link">Install
for Mac OS</a> page.</p>
</div>
<div class="section level2">
<h2 id="authentication-with-the-az-tool">Authentication with the AZ tool<a class="anchor" aria-label="anchor" href="#authentication-with-the-az-tool"></a>
</h2>
<p>The next step requires opening a command prompt. On Windows, this can
be done by searching for “command prompt” in the Start menu, or by
right-clicking the Start button and selecting “Windows PowerShell” or
“Windows Command prompt” from the pop-up menu. On Mac, you should use
the “Terminal” application. The Windows Command Prompt is shown
below.</p>
<p><img src="assets/windows-command-prmpt-new.png"></p>
<p>Next, we’ll want to log in to Azure from the command line. To do
this, simply enter the following at the command prompt. After pressing
enter, an internet browser will open where you can log into your Azure
account. If you have already logged in on the previous step, this will
simply allow you to select an account to use.</p>
<pre><code>az login</code></pre>
<p><img src="assets/az-login.gif"></p>
</div>
<div class="section level2">
<h2 id="create-connection">Create Connection<a class="anchor" aria-label="anchor" href="#create-connection"></a>
</h2>
<p>The <code>grunID</code> package comes with a function
<code>gr_db_connect</code> that will create an authentication token for
you and pass it down as your password to the appropriate
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect</a></code> function. All you will need to provide at
this point is either a <code>config.yml</code> file or your username and
host to the <code>gr_db_connect</code> function. An example of both of
these is shown below.</p>
<div class="section level3">
<h3 id="authentication-with-a-config-file">Authentication with a Config file<a class="anchor" aria-label="anchor" href="#authentication-with-a-config-file"></a>
</h3>
<p>The easiest and safest way to manage your connection to the database
is using a <code>config.yml</code> file. The <code>grunID</code> package
uses the <code>config</code> R package to parse the contents of the file
and populate an appropriate connection string. The format of the config
file is shown below.</p>
<p><strong>Note</strong>:</p>
<ul>
<li><p>The name of the file must be <strong>config.yml</strong> and be
within your working directory.</p></li>
<li><p>If using source control please be sure to add
<code>config.yml</code> to your ignores file.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> &lt;db-name will be provided&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> &lt;your-username will be provided&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">host</span><span class="kw">:</span><span class="at"> &lt;db-host will be provided&gt;</span></span></code></pre></div>
<p>All characters between <code>&lt;&gt;</code> (including the
<code>&lt;&gt;</code>) are to be replaced with values provided by the
database administrator.</p>
<p><strong>Note</strong>:</p>
<ul>
<li><p>The password is left out of the file, as it is filled in by using
the <code>az</code> tool installed in the previous step.</p></li>
<li><p>An empty line is required at the end of the config.yml
file</p></li>
</ul>
<p>With this file in place, we create a connection to the database with
the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gr_db_connect.html">gr_db_connect</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># a config file will be searched for starting at the working directory.</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"agency"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="authentication-with-username-dbname-and-host">Authentication with username, dbname and host<a class="anchor" aria-label="anchor" href="#authentication-with-username-dbname-and-host"></a>
</h3>
<p>The <code>gr_db_connect</code> function can also be called with
arguments specifying your username, database name and host for the
server for the database. Note that this is a quick way to create a
connection to the database but if using source control its also an easy
way to accidentally share your credentials. For this reason, we
recommend setting up a config file and adding it to your ignores
file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gr_db_connect.html">gr_db_connect</a></span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"myusername"</span>, </span>
<span>  dbname <span class="op">=</span> <span class="st">"dbname"</span>, </span>
<span>  host <span class="op">=</span> <span class="st">"host.com"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"agency"</span><span class="op">)</span></span></code></pre></div>
<pre><code>     id code    agency_name active created_at          creat…¹ updated_at          updat…²
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;lgl&gt;  &lt;dttm&gt;              &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;  
1     1 DWR     Department… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
2     2 CDFW    California… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
3     3 USFWS   United Sta… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
4     4 UCDAVIS University… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
# … with abbreviated variable names created_by, updated_by
</code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emanuel Rodriguez, Liz Stebbins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
