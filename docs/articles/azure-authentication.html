<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="grunID">
<title>Authentication with Azure AD • grunID</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authentication with Azure AD">
<meta property="og:description" content="grunID">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">grunID</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/azure-authentication.html">Authentication with Azure AD</a>
    <a class="dropdown-item" href="../articles/process_and_add_assay_results.html">Process and add assay results to database</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/FlowWest/grunID" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Authentication with Azure AD</h1>
            
      
      
      <div class="d-none name"><code>azure-authentication.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grunID</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="confirm-account-on-azure">Confirm Account on Azure<a class="anchor" aria-label="anchor" href="#confirm-account-on-azure"></a>
</h2>
<p>The first step in the process is to confirm that your account has
been successfully linked to Azure. To do this, navigate to the <a href="https://portal.azure.com/" class="external-link">Microsoft Azure Portal</a> and log in
with your existing credentials or create a new one. Once logged in,
click on your account.</p>
<p><img src="assets/arrow-to-account-button.png" style="width:75.0%"></p>
<p>Next click on <strong>Switch Directory</strong></p>
<p><img src="assets/azure-switch-directories.png" style="width:50.0%"></p>
<p>and confirm you have a directory for the California Department of
Water Resources. If you are not already switched to this directory do so
now. If you do not see this directory contact Emanuel Rodriguez at <a href="mailto:erodriguez@flowwest.com">erodriguez@flowwest.com</a> for
help.</p>
<p><img src="assets/azure-dir-list.png" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="install-depedencies">Install Depedencies<a class="anchor" aria-label="anchor" href="#install-depedencies"></a>
</h2>
<p>In addition to installing the R package, we need to install the Azure
Command Line Interface (CLI) to authenticate through Azure Directory.
The Azure CLI allows us to link a local R session with your Azure AD
account and authenticate a user with read/write permissions to the
database using a “token”. An overview of the tool can be found at <a href="https://learn.microsoft.com/en-us/cli/azure/" class="external-link">https://learn.microsoft.com/en-us/cli/azure/</a>.
To download and install the tool, visit the <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli" class="external-link">Install
Azure CLI on Windows</a> page, or for Mac OS visit the <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-macos" class="external-link">Install
for Mac OS</a> page.</p>
</div>
<div class="section level2">
<h2 id="authentication-with-az-tool">Authentication with AZ tool<a class="anchor" aria-label="anchor" href="#authentication-with-az-tool"></a>
</h2>
<p>The next set of steps require opening a command prompt. On Windows,
this can be done by searching for “command prompt” in the start menu, or
by right-clicking the Start button and selecting “Windows PowerShell” or
“Windows Command prompt” from the pop-up menu. We should see a blank
screen.</p>
<p><img src="assets/windows-command-prmpt-new.png"></p>
<div class="section level3">
<h3 id="log-in-with-az">Log in with AZ<a class="anchor" aria-label="anchor" href="#log-in-with-az"></a>
</h3>
<p>Next, we’ll want to log in to Azure from the command line. To do
this, simply enter the following at the command prompt. After pressing
enter, an internet browser will open where you can log into your Azure
account. If you have already logged in on the previous step, this will
simply allow you to select an account to use.</p>
<pre><code>az login</code></pre>
<p><img src="assets/az-login.gif"></p>
</div>
<div class="section level3">
<h3 id="create-a-token">Create a Token<a class="anchor" aria-label="anchor" href="#create-a-token"></a>
</h3>
<p>Next, we’ll use AZ again to create a “token” that will allow us to
authenticate using our username on Azure. Enter the following in command
prompt:</p>
<pre><code>az account get-access-token --resource-type oss-rdbms</code></pre>
<p>This will return a json formatted response with the following
content:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"accessToken"</span><span class="fu">:</span> <span class="st">"really long string of letters, numbers and symbols, this will be used as your password"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"expiresOn"</span><span class="fu">:</span> <span class="st">"2023-01-19 12:01:26.000000"</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"subscription"</span><span class="fu">:</span> <span class="st">"a subscription ID"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"tenant"</span><span class="fu">:</span> <span class="st">"a tenant ID"</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"tokenType"</span><span class="fu">:</span> <span class="st">"Bearer"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><em><strong>Note</strong> that for security purposes, these tokens
have a short expiration date of just a few hours. FlowWest is currently
working on switching to using refresh tokens, which will allow for
automatic token creation and authentication. Until then, however, you
will need to manually update this token by repeating this and the
following step.</em></p>
</div>
<div class="section level3">
<h3 id="create-a-config-file">Create a config file<a class="anchor" aria-label="anchor" href="#create-a-config-file"></a>
</h3>
<p>Next, we’ll create a <code>config.yml</code> file to store our
credentials. The file must be named <strong>config.yml</strong> and
placed within the R working directory that you plan to use for
interacting with the database. The file should have the following
contents, the password field should be filled in with the token
generated in the previous step. The remaining fields will be provided to
you.</p>
<p><em>Note that if you are repeating this step to refresh an expired
token, you simply have to replace the existing password value with your
new token and re-read this file into the R session.</em></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> &lt;db-name will be provided&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> &lt;your-username will be provided&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">port</span><span class="kw">:</span><span class="at"> &lt;db-port will be provided&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">host</span><span class="kw">:</span><span class="at"> &lt;db-host will be provided&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> &lt;paste token from previous step here&gt;</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emanuel Rodriguez, Liz Stebbins.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
