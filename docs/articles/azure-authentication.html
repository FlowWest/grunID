<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Authentication with Azure AD • grunID</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Authentication with Azure AD">
<meta property="og:description" content="grunID">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grunID</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/azure-authentication.html">Authentication with Azure AD</a>
    </li>
    <li>
      <a href="../articles/process_and_add_assay_results.html">Process and Add Assay Results to Database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Authentication with Azure AD</h1>
            
      
      
      <div class="hidden name"><code>azure-authentication.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grunID</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="confirm-account-on-azure">Confirm Account on Azure<a class="anchor" aria-label="anchor" href="#confirm-account-on-azure"></a>
</h2>
<p>The first step in the process is to confirm that your account has
been successfully linked to Azure. To do this, navigate to the <a href="https://portal.azure.com/" class="external-link">Microsoft Azure Portal</a> and log in
with your existing credentials or create a new one. Once logged in,
click on your account as shown below.</p>
<p><img src="assets/arrow-to-account-button.png" style="width:75.0%"></p>
<p>Next click on <strong>Switch Directory</strong></p>
<p><img src="assets/azure-switch-directories.png" style="width:50.0%"></p>
<p>and confirm you have a directory for the California Department of
Water Resources. If you are not already switched to this directory do so
now. If you do not see this directory contact Emanuel Rodriguez at <a href="mailto:erodriguez@flowwest.com">erodriguez@flowwest.com</a> for
help.</p>
<p><img src="assets/azure-dir-list.png" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="install-depedencies">Install Depedencies<a class="anchor" aria-label="anchor" href="#install-depedencies"></a>
</h2>
<p>In addition to installing the R package, we need to install the Azure
Command Line Interface (CLI) to authenticate through Azure Directory.
The Azure CLI allows us to link a local R session with your Azure AD
account and authenticate a user with read/write permissions to the
database using a “token”. An overview of the tool can be found at <a href="https://learn.microsoft.com/en-us/cli/azure/" class="external-link">https://learn.microsoft.com/en-us/cli/azure/</a>.
To download and install the tool, visit the <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli" class="external-link">Install
Azure CLI on Windows</a> page, or for Mac OS visit the <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-macos" class="external-link">Install
for Mac OS</a> page.</p>
</div>
<div class="section level2">
<h2 id="authentication-with-az-tool">Authentication with AZ tool<a class="anchor" aria-label="anchor" href="#authentication-with-az-tool"></a>
</h2>
<p>The next step requires opening a command prompt. On Windows, this can
be done by searching for “command prompt” in the Start menu, or by
right-clicking the Start button and selecting “Windows PowerShell” or
“Windows Command prompt” from the pop-up menu. On Mac, you should use
the “Terminal” application. The Windows Command Prompt is shown
below.</p>
<p><img src="assets/windows-command-prmpt-new.png"></p>
<p>Next, we’ll want to log in to Azure from the command line. To do
this, simply enter the following at the command prompt. After pressing
enter, an internet browser will open where you can log into your Azure
account. If you have already logged in on the previous step, this will
simply allow you to select an account to use.</p>
<pre><code>az login</code></pre>
<p><img src="assets/az-login.gif"></p>
</div>
<div class="section level2">
<h2 id="create-connection">Create Connection<a class="anchor" aria-label="anchor" href="#create-connection"></a>
</h2>
<p>The <code>grunID</code> package comes with a function
<code>gr_db_connect</code> that will create an authentication token for
you and pass it down as your password to the appropriate
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect</a></code> function. All you will need to provide at
this point is either a <code>config.yml</code> or your username and host
to the <code>gr_db_connect</code> function. An example of both of these
is shown below.</p>
<div class="section level3">
<h3 id="authentication-with-config-file">Authentication with Config file<a class="anchor" aria-label="anchor" href="#authentication-with-config-file"></a>
</h3>
<p>The easiest and safest way to manage your connection to the database
is using a <code>config.yml</code> file. The <code>grundID</code>
package uses the <code>config</code> R package to parse the contents of
the file and populate an appropriate connection string. The format of
the config file is shown below.</p>
<p><strong>Note</strong>:</p>
<ul>
<li><p>The name of the file must be <strong>config.yml</strong> and be
within your working directory.</p></li>
<li><p>If using source control please be sure to add
<code>config.yml</code> to your ignores file.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> &lt;db-name will be provided&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> &lt;your-username will be provided&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">host</span><span class="kw">:</span><span class="at"> &lt;db-host will be provided&gt;</span></span></code></pre></div>
<p>All characters between <code>&lt;&gt;</code> (including the
<code>&lt;&gt;</code>) are to be replaced with values provided by the
database administrator.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>The password is left out of the file, as it is filled in by using
the <code>az</code> tool installed in the previous step.</li>
</ul>
</div>
<div class="section level3">
<h3 id="authentication-with-username-dbname-and-host">Authentication with username, dbname and host<a class="anchor" aria-label="anchor" href="#authentication-with-username-dbname-and-host"></a>
</h3>
<p>The <code>gr_db_connect</code> function can also be called with
arguments specifying your username, database name and host for the
server for the database. Noe that this is a quick way to create a
connection to the database but if using source control its also an easy
way to accidentally share your credentials. For this reason, we
recommend setting up a config file and adding it to your ignores
file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gr_db_connect.html">gr_db_connect</a></span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"myusername"</span>, </span>
<span>  dbname <span class="op">=</span> <span class="st">"dbname"</span>, </span>
<span>  host <span class="op">=</span> <span class="st">"host.com"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"agency"</span><span class="op">)</span></span></code></pre></div>
<pre><code>     id code    agency_name active created_at          creat…¹ updated_at          updat…²
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;lgl&gt;  &lt;dttm&gt;              &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;  
1     1 DWR     Department… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
2     2 CDFW    California… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
3     3 USFWS   United Sta… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
4     4 UCDAVIS University… TRUE   2023-01-12 01:54:44 runida… 2023-01-12 01:54:44 runida…
# … with abbreviated variable names created_by, updated_by
</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emanuel Rodriguez, Liz Stebbins.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
